---
# macOS-specific tmux installation via Homebrew
- name: Install tmux and dependencies via Homebrew
  shell: |
    export HOMEBREW_NO_AUTO_UPDATE=1
    export PATH="/opt/homebrew/bin:$PATH"

    # Install tmux and its dependencies
    packages=(tmux libevent ncurses)

    for package in "${packages[@]}"; do
      if ! brew list "$package" &>/dev/null; then
        echo "Installing $package..."
        brew install "$package" || echo "Warning: Failed to install $package"
      else
        echo "$package is already installed"
      fi
    done
  args:
    executable: /bin/bash
  become: no
  register: tmux_install_result
  changed_when: "'Installing' in tmux_install_result.stdout"
  tags: blog

- name: Display tmux installation output
  debug:
    msg: "{{ tmux_install_result.stdout_lines }}"
  when: tmux_install_result.stdout_lines is defined
  tags: blog

- name: Verify tmux installation
  command: tmux -V
  register: tmux_version
  changed_when: false
  become: no
  tags: blog

- name: Display tmux version
  debug:
    msg: "âœ“ tmux installed via Homebrew: {{ tmux_version.stdout }}"
  tags: blog

# Install/update oh-my-tmux configuration (shared across platforms)
- name: Configure oh-my-tmux
  include_tasks: configure.yml
  tags:
    - oh-my-tmux
    - blog

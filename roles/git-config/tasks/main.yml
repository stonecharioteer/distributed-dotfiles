---
# Git global configuration tasks

- name: Include platform-specific tasks
  include_tasks: "{{ ansible_facts['os_family'] | lower }}.yml"
  when: ansible_facts["os_family"] == "Darwin"

- name: Configure git settings
  community.general.git_config:
    name: "{{ item.name }}"
    scope: global
    value: "{{ item.value | string | lower }}"
  loop:
    - { name: "push.autoSetupRemote", value: "{{ git_config.push.autoSetupRemote }}" }
    - { name: "pull.rebase", value: "{{ git_config.pull.rebase }}" }
    - { name: "init.defaultBranch", value: "{{ git_config.init.defaultBranch }}" }
  loop_control:
    label: "{{ item.name }}"
  become: no
  when: ansible_facts["os_family"] != "Darwin"

- name: Configure git aliases
  community.general.git_config:
    name: "alias.{{ item.key }}"
    scope: global
    value: "{{ item.value }}"
  loop: "{{ git_aliases }}"
  loop_control:
    label: "alias.{{ item.key }}"
  become: no
  when: ansible_facts["os_family"] != "Darwin"

- name: Display git configuration status
  debug:
    msg: |
      Git global configuration applied:
      - push.autoSetupRemote: {{ git_config.push.autoSetupRemote }}
      - pull.rebase: {{ git_config.pull.rebase }}
      - init.defaultBranch: {{ git_config.init.defaultBranch }}
      Aliases: {{ git_aliases | map(attribute='key') | join(', ') }}
  when: ansible_facts["os_family"] != "Darwin"
